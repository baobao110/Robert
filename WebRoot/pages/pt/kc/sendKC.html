<!DOCTYPE html>
<html>
<head>
<title>发布课程</title>

<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<script type="text/javascript" src="/ay/assets/url.js"></script>
<!-- OLYCBjuz0sbCGabBGbk6EdXjnENCATEo -->
<script type="text/javascript">

	var paths = [  {
		type : "link",
		path : "/assets/layui/css/layui.css"
	},{
		type : "link",
		path : "/assets/css/pc_mess/mess.css"
	},{
		type : "link",
		path : "/assets/ui/libs/bower/font-awesome/css/font-awesome.min.css"
	} ];

	addFilesSRC(paths);

	 var merid="1000";
</script>

<style type="text/css">
.load_tc_back {
	width:100%;
	height: 100%;
	position: fixed;
	top:0;
	left: 0;
	  z-index: 1001;
	  overflow:hidden;
	display:-webkit-flex;
	-webkit-justify-content:center;
	-webkit-align-items:center;
	background:rgba(0,0,0,0.6);
}

.mp3show{ height: 40px; line-height: 40px;}
.mp3show a{float: right; color: #308CE2;}

.ump3{margin-bottom: 20px;
    margin-left: 10px;}
.fileinput-button {
            position: relative;
      display: inline-block;
      overflow: hidden;
  }

  .fileinput-button input{
      position:absolute;
      right: 0px;
      top: 0px;
      opacity: 0;
      -ms-filter: 'alpha(opacity=0)';
      font-size: 200px;
  }
</style>

</head>

<body style="background: #F1F1F2" id="bodyarea">
	<div class="layui-container">

		<div class="layui-row layui-form"
			style="width: 100%;display: inline-block;">


			<ul class="layui-timeline" id="allmodal" >
				<li class="layui-timeline-item">
					<div class="layui-timeline-content layui-text"></div></li>




				<li class="layui-timeline-item"><i
					class="layui-icon layui-timeline-axis" data="&#xe63c;">&#xe63c;</i>
					<div class="layui-timeline-content layui-text">
						<h3 class="layui-timeline-title">课程基本内容</h3>
						<div class="layui-tab-item layui-show">



							<div class="layui-form-item">
								<label class="layui-form-label"><b class="red">*</b>标题</label>
								<div class="layui-input-block">
									<input name="title"  autocomplete="off"
										placeholder="请输入标题" lay-verify="required"
										maxlength="30" class="layui-input width500" type="text"
										id="title">
										
										<p class="info">不大于30个字符</p>
								</div>
							</div>
							

							<div class="layui-form-item">
								<label class="layui-form-label"><b class="red">*</b>排序</label>
								<div class="layui-input-block">
									<input name="orderby"  autocomplete="off"
										placeholder="排序" lay-verify="required"
										maxlength="3" class="layui-input width200 orderby" type="text"
										id="orderby">
										
								</div>
							</div>



				
							

						</div>
					</div>
				</li>


				

				



				
			</ul>


			<div style="margin-left:30px" onclick="addOneModal(this)" class="layui-btn  layui-btn-big layui-btn-normal"><i class="layui-icon">&#xe654;</i>添加版块</div>




		</div>
		<div class="layui-row" align="center"
			style="margin-bottom: 50px;margin-top: 20px" id="workdo">
			
			
			


		</div>
	</div>


<div style="display:none" id="uploadppt"></div>

<!-- 录音并上传弹出 -->
<div id="upload_mp3_page" class="load_tc_back" style="display: none;">
	<div style="width: 600px; padding: 10px; background: #fff;"> 
	 	<div style="height: 40px; line-height: 40px; ">
	 		<label style="font-size: 20px;">录音并上传</label>
	 		<label style="font-size: 16px;float: right;" onclick="close_mp3();">[关闭]</label>
	 	</div> 
	 	<div style="clear: both;"></div>
	 	<hr class="layui-bg-cyan">
	 	<fieldset class="layui-elem-field">
		  <legend>说明</legend>
		  <div class="layui-field-box">录音请在Chrome或Microsoft Edge浏览器打开！<span id="mp3_msg" style="color: red;"></span></div>
		</fieldset>
		<div class="layui-form-item mp3show" id="recordingslist">
		</div>
		<div style="clear: both;"></div>
		
		<div class="layui-form-item" style="text-align: center;"> 
		<button class="layui-btn layui-btn-primary" onclick="funStart(this);" id="btnStart" disabled>录制</button>
        <button class="layui-btn layui-btn-primary" onclick="funStop(this);" id="btnStop" disabled>停止</button>
        <button class="layui-btn layui-btn-primary" onclick="funUpload(this);" id="btnUpload" disabled>上传</button>
		</div> 
	</div>
</div>
 

<!--上传音频文件 -->
<div id="upload_my_page" class="load_tc_back" style="display: none;">
	<div style="width: 400px; padding: 10px; background: #fff;">
		<div style="height: 40px; line-height: 40px; ">
	 		<label style="font-size: 20px;">上传音频文件</label>
	 		<label style="font-size: 16px;float: right;" onclick="close_my(this);">[关闭]</label>
	 	</div> 
	 	<div style="clear: both;"></div>
	 	 <hr class="layui-bg-cyan"> 
	 	 <br>
		<div class="layui-form-item" > 
			<form id="my_form">
  		 	<span class="layui-btn layui-btn-primary fileinput-button input_border" style="width: 100%; text-align: left; padding-left: 5px;">
	            <span>请选择上传MP3文件</span>
	            <input type="file" id="myfile" name="myfile"  accept="audio/*" >
	        </span>
	        </form> 
  		</div>
		
		<div class="layui-form-item" style="text-align: center;">  
        	<button class="layui-btn " onclick="upload_mymp3();" id="uploadmy">确认上传</button>
		</div> 
		
	</div>
</div>


<!--上传音频文件 -->
<div id="upload_my_page2" class="load_tc_back" style="display: none;">
	<div style="width: 400px; padding: 10px; background: #fff;">
		<div style="height: 40px; line-height: 40px; ">
	 		<label style="font-size: 20px;">上传视频文件</label>
	 		<label style="font-size: 16px;float: right;" onclick="close_my(this);">[关闭]</label>
	 	</div> 
	 	<div style="clear: both;"></div>
	 	 <hr class="layui-bg-cyan"> 
	 	 <br>
		<div class="layui-form-item" > 
			<form id="my_form2">
  		 	<span class="layui-btn layui-btn-primary fileinput-button input_border" style="width: 100%; text-align: left; padding-left: 5px;">
	            <span>请选择上传视频文件,如:MP4、avi、wav等</span>
	            <input type="file" id="myfile2" name="myfile2" accept="video/*" >
	        </span>
	        </form> 
  		</div>
		
		<div class="layui-form-item" style="text-align: center;">  
        	<button class="layui-btn " onclick="upload_mymp4();" id="uploadmy">确认上传</button>
		</div> 
		
	</div>
</div>
 
</body>
<script type="text/javascript">
	var paths = [  {
		type : "src",
		path : "/assets/js/jquery-3.1.1.min.js"
	},{
		type : "src",
		path : "/assets/layui/layui.js"
	},
	/*****图片工具start****/
	{
		type : "link",
		path : "/assets/imgutil/imgutil.css"

	}, {
		type : "src",
		path : "/assets/imgutil/imgUtil.js"

	}
	/*****图片工具end****/
	/*****录音工具****/
	, {
		type : "src",
		path : "/assets/utils/recordmp3/recordmp3.js"

	}
	/*****录音工具****/
	
	//
	, {
		type : "src",
		path : "/assets/utils/mess/chooseUtil.js",
		version:2
	}
	,{
		type : "src",
		path : "/assets/login.js"

	} 
	
	];

	addFilesSRC(paths);
</script>
<script type="text/javascript">
	var messobj={};
	//商家id
	messobj.merid=merid;
	//编辑
	var messid = GetQueryString("messid");
	
	

</script>

<script type="text/javascript">

    var pptx="";
	var  form, layer, element,upload;
	layui.use([ 'form', 'layer', 'element','laydate','upload'], function() {
		form = layui.form;
		layer = parent.layer === undefined ? layui.layer : parent.layer;
		element = layui.element;
		upload= layui.upload;
		form.render();
		
		upload.render({
		    elem: $("#uploadppt")
		    ,url: getRootPath() + "/uploadppt/uploadPptx.do"
		    ,accept: 'file' //普通文件
		    ,exts: 'pptx' //只允许上传压缩文件
		    ,done: function(res){
		        
		    	pptx=res.pptx;
		    	
		    	var arr=res.data;
		    	
		    	$("#allmodal").append(addModalByPptx(arr));
		    	
		    	layer.closeAll();
		    	
		    },before:function(){
		    	 layer.load(1, {
		    		  shade: [0.1,'#fff'] //0.1透明度的白色背景
		    		});
		    },error: function(){
		    	
		    	layer.closeAll();
		    	layer.msg("上传异常");
		    }
		  });

		$(function() {
			$(".layui-timeline-axis,h3.layui-timeline-title").on("click",
					function() {
						var obj = $(this).closest("li");
						var divobj = obj.find(".layui-tab-item");
						divobj.toggleClass("layui-show");
						if (divobj.hasClass("layui-show")) {
							var o = obj.find(".layui-timeline-axis");
							o.html(o.attr("data"));

						} else {
							obj.find(".layui-timeline-axis").html("&#xe60f;");
						}

					});
			
			
			//编辑时
			if (messid != null && messid != "") {
				$.ajax({
					type : "post",
					url : getRootPath() + "/message/ajaxOneMessByid.do",
					data : {
						id : messid
					},
					dataType : "json",
					success : function(data) {
						messobj=data;
						showMess();
					}
				});

			}else{
				showMess();
			}

		});
		
	
		
		stertup_choose(form);
		
		
		
	});
	
	
//-----------------

var recorder = new MP3Recorder({
     debug:true,
     funOk: function () {
         btnStart.disabled = false;
         log('初始化成功');
     },
     funCancel: function (msg) {
         log(msg);
         recorder = null;
     }
});
var mp3Blob;
var mp3state = 0;

var add_button;//音频
var add_button2;//视频

function add_upload_show(obj) {
	add_button = obj;
	mp3state = 0;
	
	$("#recordingslist").html("");
	//$("#mp3_msg").text(""); 
	$("#upload_mp3_page").show();
	 
}

function close_mp3(){
	$("#upload_mp3_page").hide();
}

 
function log(msg){
	console.log(msg);
	$("#mp3_msg").text(msg);
}

function funStart(button) {
    btnStart.disabled = true;
    btnStop.disabled = false;
    btnUpload.disabled = true;
    log('录音开始...');
    mp3state = 1;
    recorder.start();
}

function funStop(button) {
	
	if(mp3state < 1){
		layer.msg("请先开始录音！");
	}else{
		mp3state = 2;
		recorder.stop();
	    btnStart.disabled = false;
	    btnStop.disabled = true;
	    btnUpload.disabled = false; 
	    recorder.getMp3Blob(function (blob) {
	        log('录音成功');

	        mp3Blob = blob;
	        var url = URL.createObjectURL(mp3Blob);
	        
	        var str = "<audio controls src='"+url+"'></audio><a href='"+url+"' download='test.mp3' >下载录音文件</a>";
	        
	        $("#recordingslist").html(str);
	         
	    });
	}
	 
}

function funUpload() {
	
	if(mp3state < 2){
		layer.msg("请先录好音频文件！");
	}else{
		var fd = new FormData();
	    var mp3Name = encodeURIComponent('audio_recording_' + new Date().getTime() + '.mp3');
	    fd.append('fileName', mp3Name);
	    fd.append('file', mp3Blob);
	    
	    $.ajax({
			type:"post",
	 		url: getRootPath() +"/jd/uploadmp3.do",
	 		dataType:"json",
	 		data : fd,
	 		cache: false,  
			processData: false,  
			contentType: false,
	 		success: function(data){ 
	 			$("#upload_mp3_page").hide();
	 			if(data[0].back_code == 200){
	 				
	 				var str = "<audio name='myaudio' class='myaudio' srcurl='"+data[0].file_path+"' src='"+getRootPath()+data[0].file_path+"' controls=''></audio>";
	 				
	 				$(add_button).siblings("span").html(str);
	 				
	 			}else{
	 				layer.msg("上传异常");
	 			}
	 			
	 		}
	    });
	}
     
}

function upload_mymp3(){
	
	var myfile = $("#myfile").val();
	if(myfile == ""){
		layer.msg("请选择上传MP3文件");
		 return false;
	}else{
		 var formData = new FormData($("#my_form")[0]);
		 
		 $.ajax({
				type:"post",
		 		url: getRootPath() +"/jd/upload_mymp3.do",
		 		dataType:"json",
		 		data : formData,
		 		cache: false,  
				processData: false,  
				contentType: false,
		 		success: function(data){ 
		 			$("#upload_my_page").hide();
		 			if(data[0].back_code == 200){
		 				
		 				var str = "<audio name='myaudio' class='myaudio' srcurl='"+data[0].file_path+"' src='"+getRootPath()+data[0].file_path+"' controls=''></audio>";
		 				
		 				$(add_button).siblings("span").html(str);
		 				
		 			}else{
		 				layer.msg("请选择上传MP3文件");
		 			}
		 			
		 		}
		    });
	}
}

function uploadmy_show(obj){
	add_button = obj;
	$("#myfile").val("");
	$("#upload_my_page").show();
}


function close_my(obj){
	$(obj).closest(".load_tc_back").hide();
}
//视频
function uploadmy_video(obj){
	add_button2=obj;
	$("#myfile2").val("");
	$("#upload_my_page2").show();
	
}
	
	

function upload_mymp4(){
	
	var myfile = $("#myfile2").val();
	if(myfile == ""){
		layer.msg("请选择上传视频文件");
		 return false;
	}else{
		 var formData = new FormData($("#my_form2")[0]);
		 
		 var index = layer.load(1, {
			  shade: [0.1,'#fff'] //0.1透明度的白色背景
			});
		 
		 $.ajax({
				type:"post",
		 		url: getRootPath() +"/jd/upload_mymp4.do",
		 		dataType:"json",
		 		data : formData,
		 		cache: false,  
				processData: false,  
				contentType: false,
		 		success: function(data){ 
		 			
		 			layer.close(index)
		 			$("#upload_my_page2").hide();
		 			if(data[0].back_code == 200){
		 				
		 				var str = "<video  width='500' height='300' name='myvideo' class='myvideo' srcurl='"+data[0].file_path+"' src='"+getRootPath()+data[0].file_path+"' controls=''></audio>";
		 				
		 				$(add_button2).siblings("span").html(str);
		 				
		 			}else{
		 				layer.msg("请选择上传视频文件");
		 			}
		 			
		 		}
		    });
	}
}
</script>
<!-- <script type="text/javascript" src="/bi/assets/merchants_check.js"></script> -->
</html>
